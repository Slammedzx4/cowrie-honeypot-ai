Recommended demo order:

Start Cowrie on honeypot (twistd -n cowrie).

From Kali: generate attacker traffic (many passwords + recon commands on -p 2222).

From normal Ubuntu VM: generate benign traffic (one login, simple commands on -p 2222).

On honeypot: run ./ai.sh and show IPs / creds / commands / AI line.

On honeypot (root):

ufw allow from <normal-ip> to any port 22 proto tcp

optionally ufw deny from <attacker-ip>

From normal VM: show that ssh root@10.0.2.15 (port 22) now works.

From Kali: show that access is blocked or restricted according to your rules.

This completes the reproducible AI-enhanced SSH honeypot lab.


---

## 3️⃣ File #2 – `analysis/ai.sh`

**Path:** `analysis/ai.sh` (inside a folder called `analysis` in the repo)

In your repo:

```bash
mkdir -p analysis


Then create analysis/ai.sh with this content:

#!/bin/bash
LOG="/home/cowrie/cowrie/var/log/cowrie/cowrie.json"

RED='\033[0;31m'; GREEN='\033[0;32m'; YELLOW='\033[1;33m'; NC='\033[0m'

if [ ! -f "$LOG" ]; then
    echo -e "${RED}Log file not found: $LOG${NC}" >&2
    exit 1
fi

if ! command -v jq >/dev/null 2>&1; then
    echo -e "${RED}jq is not installed → sudo apt install jq${NC}" >&2
    exit 1
fi

if ! command -v ollama >/dev/null 2>&1; then
    echo -e "${YELLOW}Ollama not found (AI is optional).${NC}"
    echo -e "${YELLOW}Install it with: curl -fsSL https://ollama.com/install.sh | sh${NC}"
    echo -e "${YELLOW}Then: ollama pull gemma2:2b${NC}"
fi

echo -e "${GREEN}Recent attackers on your Cowrie honeypot:${NC}"
echo "================================================"

tail -1000 "$LOG" 2>/dev/null | \
  jq -r 'select(.eventid=="cowrie.session.connect") | .src_ip' | \
  sort -u | head -10 | \
  while read -r ip; do
      ip_events=$(grep -F "\"$ip\"" "$LOG" 2>/dev/null || true)

      creds=$(printf '%s\n' "$ip_events" | \
              jq -r 'select(.eventid=="cowrie.login.success") | .username + "/" + .password' 2>/dev/null | \
              head -1)

      cmds=$(printf '%s\n' "$ip_events" | \
             jq -r 'select(.eventid=="cowrie.command.input") | .input' 2>/dev/null | \
             head -7 | paste -sd'; ' -)

      [ -z "$creds" ] && creds="(no successful login)"
      [ -z "$cmds" ] && cmds="(no commands)"

      echo
      echo -e "${YELLOW}IP:${NC} $ip"
      echo "Creds: $creds"
      echo "Commands: $cmds"
      echo -n "AI → "
      if command -v ollama >/dev/null 2>&1; then
        ollama run gemma2:2b "In one short sentence, what is this attacker doing? IP:$ip Creds:$creds Commands:$cmds" 2>/dev/null || echo "(AI error)"
      else
        echo "(AI model not installed on this VM)"
      fi
      echo "────────────────────────────────────"
  done

echo -e "\n${GREEN}Done! Run ./ai.sh anytime.${NC}"


On the honeypot VM (as cowrie), you copy this file into /home/cowrie/analysis/ai.sh and run:

chmod +x /home/cowrie/analysis/ai.sh
